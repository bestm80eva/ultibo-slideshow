machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "docker-cache"
  override:
    - mkdir -p docker-cache \
    - if [[ -e docker-cache/ufpc.tar ]] \
      then \
          docker load -i docker-cache/ufpc.tar \
      else \
          docker pull markfirmware/ufpc \
          docker save markfirmware/ufpc > docker-cache/ufpc.tar
  post:
    - sudo apt-get update && sudo apt-get install -y qemu-system-arm
    
test:
  override:
    - ./docker-test.sh
  post:
    - mv output $CIRCLE_ARTIFACTS/test-output
    - mkdir $CIRCLE_ARTIFACTS/kernels
    - mv kernel*.img kernel.bin $CIRCLE_ARTIFACTS/kernels
